---
title: v3.13.1 Release
tags: [release]
authors: [matsubokkuri]
---

<!-- truncate -->
# リリース内容


## 📋 新機能・改善

### 🏭 メーカー向け

#### バックエンドタスク管理の強化
- **削除機能の追加**: 管理者権限でバックエンドタスクを削除できるようになりました
  - 削除確認ダイアログでの安全な削除操作
  - アクセス制御（管理者権限のみ）を適用

#### 注文明細一覧の改良
- **検索フォームのレイアウト改善**: より使いやすいフォーム配置とボタンデザイン
- **テーブル表示の最適化**: 水平スクロール時の列幅調整（`min-width`による固定幅から可変幅へ）
- **アクティブな小売業者のみ表示**: 無効な関係の小売業者を検索対象から除外
- **空状態の改善**: データがない場合にアラート形式での分かりやすい表示

#### パフォーマンス最適化
- **アクティブな小売業者取得の高速化**: メモ化機能により同一リクエスト内での重複クエリを削減
- **営業所検索の最適化**: アクティブな小売業者の営業所のみに絞り込み

### 🏪 小売向け

#### バックエンドタスク管理の強化
- **削除機能の追加**: メーカー向けと同様の削除機能を追加
  - 管理者権限による安全な削除操作

#### ガス種表示の視認性向上
- **ガス種バッジの色分け**: LP（黒）、12・13A（黄色）で明確に区別
- **商品詳細でのガス種ボタン**: 統一されたデザインでガス種選択時の視認性を向上
- **カート画面でのガス種表示**: 関連商品でも統一されたボタンスタイルを適用
- **注文確認画面**: ガス種ラベルの表示を統一

### 👤 管理者向け

#### システム管理機能の強化
- **バックエンドタスク削除権限**: メーカー・小売の両方で管理者のみが削除可能
- **エラーハンドリングの改善**: 404エラーの適切な処理を追加
  - `ActionController::RoutingError`
  - `AbstractController::ActionNotFound`

### ⚙️ システム関連

#### パフォーマンス・安定性の改善
- **ログレベルの最適化**: 本番環境でのデフォルトログレベルを`warn`に設定
- **バックエンドタスクのライフサイクル管理**: メール送信を`after_commit`に変更してデータ整合性を向上
- **Pumaワーカーキラーの静音化**: 不要なログ出力を削減

#### 新しいデータモデル・スコープ
- **Makerモデル**: `active_retails`、`active_retail_ids`メソッドの追加とメモ化
- **RetailsMakerモデル**: `active_retails`、`with_retail`スコープの追加
- **RetailSalesOfficeモデル**: `for_active_retails`スコープの追加

#### Docker・インフラ設定
- **Node.js設定の整理**: レガシープロバイダーサポートの重複設定を削除
- **設定ファイルの整理**: 不要なRails設定ファイルを削除
  - `new_framework_defaults_7_1.rb`
  - `backtrace_silencers.rb`

#### 依存関係の更新
- **net-imap**: 0.5.8 → 0.5.9
- **rake**: 13.2.1 → 13.3.0
- **rdoc**: 6.14.0 → 6.14.2
- **websocket-driver**: 0.7.7 → 0.8.0
- **zeitwerk**: 2.7.2 → 2.7.3

## 📚 ドキュメント・開発体験の改善

### Diátaxisフレームワークの採用
プロジェクトドキュメントを体系的に再構成し、人間とAI（LLM）の両方にとって使いやすい構造に変更：

#### 新しいドキュメント構造
- **`.claude/explanation/`**: アーキテクチャの背景と設計思想
  - `knowledge.md`: 技術選定理由と設計判断
  - `history.md`: プロジェクト変更履歴と意思決定記録
- **`.claude/how-to-guides/`**: 具体的な操作手順
  - `cookbook.md`: コマンドリファレンスと実装レシピ
- **`.claude/reference/`**: 技術的リファレンス
  - `debug-log.md`: 重要なデバッグ記録

#### AIとの協調を前提とした設計
- **CLAUDE.md**: LLM向けマスタードキュメント
- **シンボリックリンク**: `GEMINI.md`、`.github/copilot-instructions.md`で複数AI対応
- **人間とAIの参照フローの分離**: それぞれに最適化された情報アクセス

### テスト強化
- **Makerモデル**: アクティブな小売業者取得機能のテスト
- **RetailSalesOfficeモデル**: 新しいスコープのテスト
- **RetailsMakerモデル**: アクティブな関係性取得のテスト

---

## ⚠️ 注意事項

### メーカー向け
- 注文明細一覧の検索では、アクティブな小売業者のみが表示されるようになります
- バックエンドタスクの削除は管理者権限のみで利用可能です

### 小売向け
- ガス種の色分けにより視認性が向上しましたが、既存のワークフローに影響はありません
- バックエンドタスクの削除は管理者権限のみで利用可能です

### システム管理者向け
- 本番環境でのログ出力が削減される可能性があります（`RAILS_LOG_LEVEL`環境変数で調整可能）


このリリースは、各ユーザータイプの利便性向上とシステム全体の品質改善に焦点を当てています。特に、ドキュメント構成の改善により、新しい開発者の参加やAIツールとの協調がより効率的になります。

https://github.com/tanomimaster/tanomimaster-www/compare/v3.13.0...v3.13.1
